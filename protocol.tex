% =============================================================================
%  Copyright (c) 2015 UCR-UAS
%  You should have recieved a copy of the MIT licence with this file.
%  Engineer: Brandon Lu
%  Description: This is the LaTeX documentation for the transfer protocol
% =============================================================================

\documentclass[12pt]{article}
\usepackage{parskip}
\usepackage{fullpage}
\usepackage{graphicx}
\usepackage{verbatim}
\usepackage{hyperref}
\setlength{\parindent}{15pt}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{textcomp}
\usepackage{dingbat}

\author{Brandon Lu @ UCR UAS}
\title{BISON-Transfer Protocol Explained}
\date{14 March 2015}

\begin{document}
\maketitle
\section{Introduction}
This document describes the BISON-Transfer server and client suite's methods
of communication.  If it is not clear by this point, the server (or daemon)
is called \verb+BISON-Transferd+ and the client (client daemon, to be precise)
is called \verb+BISON-Transfer+.

At initialization, the transfer server fork is in an unknown state.  It must
recieve a \hyperref[sec:Transfer Modes]{transfer mode} from the client or it
will not know what to
do and will terminate.

After it has recieved a \hyperref[sec:Transfer Modes]{transfer mode}, it can
then proceed to either \hyperref[ssec:Request File]{send the file},
\hyperref[ssec:Request Filetable]{send the filetable},
or \hyperref[ssec:Recalculate MD5]
{recalculate and then send the md5 sum} of a file. 

\tableofcontents

\section{Transfer Modes}
\label{sec:Transfer Modes}
There are three transfer modes that have been (or will be) implemented:
\begin{center}
	\begin{tabular}{r l}
		\verb+REQ:+\textvisiblespace <filename>\carriagereturn\carriagereturn
		& File Request\\
		\verb+FTREQ+\carriagereturn\carriagereturn & Filetable Request \\
		\verb+RECALC:+\textvisiblespace <filename>\carriagereturn
		\carriagereturn & Request MD5 Recalculation
	\end{tabular}
\end{center}

Please note that the \carriagereturn character is meant to represent ASCII
newline (decimal \verb+10+, hexadecimal \verb+0x0A+).  The
visible space (\textvisiblespace) is meant to notate an ASCII space (decimal
\verb+32+, hexadecimal \verb+0x20+).
It is simply convenient to have these symbols explicitly stated.

It should also be noted that the <filename> should be entirely replaced with
the corresponding filename that is going to be transferred.

\subsection{File Request}
\label{ssec:Request File}
The file request mode is signified by the client querying the server for the
file by providing the following line.

\noindent
\verb+REQ+:\textvisiblespace <filename>\carriagereturn\carriagereturn

The server, after recieving this line, will provide the corresponding file in
unencrypted binary over the port.

\subsection{Filetable Request}
\label{ssec:Request Filetable}
The client requests the filetable using the following line:

\noindent
\verb+FTREQ+\carriagereturn\carriagereturn

The filetable format is done by line, and files are not expected to have
newlines in their names.

\noindent
<MD5 SUM (32 hex-representing ASCII characters)>\textvisiblespace
\textvisiblespace<filename>\carriagereturn

The last line of the filetable will have a newline as well.  This is followed
by the server terminating the connection.

\subsection{Request Filetable Recalculation}
\label{ssec:Recalculate MD5}
To be written.

\section{Client State Machines}
To be written.

\section{Security}
\label{sec:Security}
In a closed-system, security is not generally considered for simplicity sake.
This is not a system designed for large-scale deployment by any means.
It is designed to work for its designated purpose, and only that purpose.
Any other use of it is probably unsafe, and the author does not have grandiose
visions of the software's use anywhere other than transferring volume-trivial
files such as the images acquired from an unmanned aerial vehicle built by
students from UCR.

But considering security for the heck of it is an interesting topic in general.
This is especially true when it comes to code-masochists like the author.

\subsection{Filenames}
\label{ssec:Filenames}
Filenames should not contain newlines for sanity sake.

A file with a newline will cause the program to either reject the file or
exit on error condition.

\subsection{Random Characters}
\label{ssec:Random Characters}
Random characters from the server under file transfer mode can potentially
cause the BISON-Transfer daemon to overload the filesystem on the client side.
This issue is not addressed because it will not happen unless an unsafe server
masquerades as \verb+BISON-Transferd+.

Random characters entering the command parsing state machine from an attacker
client will cause the corresponding thread on the server to abort.

It is noted that the client does not reject random characters from the server
before it issues a command.  This may or may not be resolved at a later date.

\section{Performance}
\label{sec:Performance}
Transfer overhead is fairly low, and mostly depends on underlying hardware and
TCP/IP stack.

The protocol simply asks the full file name and expects to get the file back.

\end{document}
